CMAKE_MINIMUM_REQUIRED( VERSION 3.1 )

PROJECT( find_fltk_mwe_SUPER_PROJECT )

set( CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake ${CMAKE_MODULE_PATH} )

INCLUDE( ExternalProject )
INCLUDE( ExternalProject_ForceBuild )

ExternalProject_Add( Libraries
	SOURCE_DIR ${CMAKE_SOURCE_DIR}/../Libraries
	CMAKE_ARGS -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
		-DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
		-DCMAKE_CXX_FLAGS=${CMAKE_CXX_FLAGS}
		-DCMAKE_C_FLAGS=${CMAKE_C_FLAGS}
		-DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
		-DUSE_SYSTEM_FLTK=${USE_SYSTEM_FLTK}
	INSTALL_COMMAND ""
)
ExternalProject_Get_Property( Libraries BINARY_DIR )
SET( LIBRARY_PATH ${BINARY_DIR} )
EP_ForceBuild( Libraries )

ExternalProject_Add( find_fltk_mwe
	SOURCE_DIR ${CMAKE_SOURCE_DIR}/..
	CMAKE_ARGS -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
		-DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
		-DCMAKE_CXX_FLAGS=${CMAKE_CXX_FLAGS}
		-DCMAKE_C_FLAGS=${CMAKE_C_FLAGS}
		-DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
		-DLIBRARY_PATH=${LIBRARY_PATH}
		-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
	INSTALL_COMMAND ${CMAKE_COMMAND} --build <BINARY_DIR> --target install
	DEPENDS Libraries
)
EP_ForceBuild( find_fltk_mwe )

ExternalProject_Add_Step( find_fltk_mwe package
    COMMAND ${CMAKE_COMMAND} --build <BINARY_DIR> --target package
    DEPENDEES build
)
